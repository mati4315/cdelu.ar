<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loterías - CdelU</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .lottery-card {
            transition: transform 0.2s, box-shadow 0.2s;
            border: 1px solid #e0e0e0;
        }
        .lottery-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .status-badge {
            font-size: 0.8rem;
        }
        .timer {
            font-size: 1.2rem;
            font-weight: bold;
            color: #dc3545;
        }
        .progress-custom {
            height: 8px;
            border-radius: 4px;
        }
        .btn-lottery {
            border-radius: 20px;
            font-weight: 500;
        }
        .number-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            gap: 5px;
            margin-top: 10px;
        }
        .number-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #e0e0e0;
            background: white;
            color: #333;
            font-weight: bold;
            transition: all 0.2s;
        }
        .number-btn:hover {
            border-color: #007bff;
            background: #f8f9fa;
        }
        .number-btn.selected {
            border-color: #007bff;
            background: #007bff;
            color: white;
        }
        .number-btn.sold {
            border-color: #dc3545;
            background: #dc3545;
            color: white;
            cursor: not-allowed;
        }
        .navbar-brand {
            font-weight: bold;
            color: #667eea !important;
        }
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px 0;
        }
        .feature-card {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .feature-icon {
            font-size: 2.5rem;
            color: #667eea;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-dice"></i> CdelU Loterías
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text me-3" id="userInfo">
                    <i class="fas fa-user"></i> <span id="username">Invitado</span>
                </span>
                <button class="btn btn-outline-light btn-sm me-2" onclick="showLoginModal()" id="loginBtn">
                    <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
                </button>
                <button class="btn btn-outline-light btn-sm" onclick="logout()" id="logoutBtn" style="display: none;">
                    <i class="fas fa-sign-out-alt"></i> Salir
                </button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container text-center">
            <h1 class="display-4 mb-4">¡Participa en nuestras Loterías!</h1>
            <p class="lead mb-4">Gana premios increíbles con nuestras loterías gratuitas y de pago</p>
            <div class="row justify-content-center">
                <div class="col-md-3">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-gift"></i>
                        </div>
                        <h5>Premios Increíbles</h5>
                        <p class="text-muted">Participa y gana premios únicos</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-ticket-alt"></i>
                        </div>
                        <h5>Loterías Gratuitas</h5>
                        <p class="text-muted">Participa sin costo alguno</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h5>100% Seguro</h5>
                        <p class="text-muted">Sistema confiable y transparente</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <div class="container mt-5">
        <!-- Filters -->
        <div class="row mb-4">
            <div class="col-md-8">
                <div class="btn-group" role="group">
                    <input type="radio" class="btn-check" name="filterType" id="all" value="" checked>
                    <label class="btn btn-outline-primary" for="all">Todas</label>
                    
                    <input type="radio" class="btn-check" name="filterType" id="free" value="true">
                    <label class="btn btn-outline-success" for="free">Gratuitas</label>
                    
                    <input type="radio" class="btn-check" name="filterType" id="paid" value="false">
                    <label class="btn btn-outline-warning" for="paid">De Pago</label>
                </div>
            </div>
            <div class="col-md-4 text-end">
                <button class="btn btn-primary" onclick="refreshLotteries()">
                    <i class="fas fa-sync"></i> Actualizar
                </button>
            </div>
        </div>

        <!-- Lotteries Grid -->
        <div class="row" id="lotteriesContainer">
            <!-- Las loterías se cargarán aquí dinámicamente -->
        </div>

        <!-- Pagination -->
        <nav aria-label="Paginación de loterías" class="mt-4">
            <ul class="pagination justify-content-center" id="pagination">
                <!-- Paginación se generará dinámicamente -->
            </ul>
        </nav>
    </div>

    <!-- Modal de Login -->
    <div class="modal fade" id="loginModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Iniciar Sesión</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="loginUsername" class="form-label">Usuario</label>
                            <input type="text" class="form-control" id="loginUsername" required>
                        </div>
                        <div class="mb-3">
                            <label for="loginPassword" class="form-label">Contraseña</label>
                            <input type="password" class="form-control" id="loginPassword" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="login()">Iniciar Sesión</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Participación -->
    <div class="modal fade" id="participationModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Participar en Lotería</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="lotteryDetails">
                        <!-- Detalles de la lotería se cargarán aquí -->
                    </div>
                    
                    <hr>
                    
                    <div id="participationForm">
                        <h6>Selecciona tus números:</h6>
                        <div class="number-grid" id="numberGrid">
                            <!-- Los números se generarán dinámicamente -->
                        </div>
                        
                        <div class="mt-3">
                            <strong>Números seleccionados: </strong>
                            <span id="selectedNumbers">Ninguno</span>
                        </div>
                        
                        <div class="mt-3">
                            <strong>Total a pagar: </strong>
                            <span id="totalAmount">$0</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="buyTickets()" id="buyButton">
                        <i class="fas fa-shopping-cart"></i> Comprar Tickets
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Mis Tickets -->
    <div class="modal fade" id="myTicketsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Mis Tickets</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="myTicketsBody">
                    <!-- Los tickets se cargarán aquí -->
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        // Configuración global
        const API_BASE = '/api/v1/lotteries';
        let currentPage = 1;
        let currentLottery = null;
        let selectedNumbers = [];
        let isLoggedIn = false;

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            loadLotteries();
            setupEventListeners();
        });

        // Verificar autenticación
        async function checkAuth() {
            const token = localStorage.getItem('token');
            if (token) {
                try {
                    const response = await axios.get('/api/v1/auth/me', {
                        headers: { Authorization: `Bearer ${token}` }
                    });
                    
                    isLoggedIn = true;
                    document.getElementById('username').textContent = response.data.user.username;
                    document.getElementById('loginBtn').style.display = 'none';
                    document.getElementById('logoutBtn').style.display = 'inline-block';
                } catch (error) {
                    localStorage.removeItem('token');
                    isLoggedIn = false;
                }
            }
        }

        // Configurar event listeners
        function setupEventListeners() {
            // Filtros
            document.querySelectorAll('input[name="filterType"]').forEach(radio => {
                radio.addEventListener('change', () => loadLotteries(1));
            });
        }

        // Cargar loterías
        async function loadLotteries(page = 1) {
            try {
                const filterType = document.querySelector('input[name="filterType"]:checked').value;
                
                let url = `${API_BASE}?page=${page}&limit=12`;
                if (filterType) {
                    url += `&is_free=${filterType}`;
                }

                const response = await axios.get(url);
                displayLotteries(response.data.data);
                displayPagination(response.data.pagination);
                currentPage = page;
            } catch (error) {
                console.error('Error al cargar loterías:', error);
                showAlert('Error al cargar las loterías', 'danger');
            }
        }

        // Mostrar loterías
        function displayLotteries(lotteries) {
            const container = document.getElementById('lotteriesContainer');
            container.innerHTML = '';

            if (lotteries.length === 0) {
                container.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="fas fa-ticket-alt fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">No hay loterías disponibles</h5>
                        <p class="text-muted">Vuelve más tarde para ver nuevas loterías</p>
                    </div>
                `;
                return;
            }

            lotteries.forEach(lottery => {
                const card = createLotteryCard(lottery);
                container.appendChild(card);
            });
        }

        // Crear tarjeta de lotería
        function createLotteryCard(lottery) {
            const col = document.createElement('div');
            col.className = 'col-md-6 col-lg-4 mb-4';
            
            const statusClass = getStatusClass(lottery.current_status || lottery.status);
            const isFree = lottery.is_free ? 'Gratuita' : 'De pago';
            const price = lottery.is_free ? 'Gratis' : `$${lottery.ticket_price}`;
            const progress = Math.round((lottery.tickets_sold || 0) / lottery.max_tickets * 100);
            
            // Calcular tiempo restante
            const timeRemaining = getTimeRemaining(lottery.end_date);
            
            col.innerHTML = `
                <div class="card lottery-card h-100">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span class="badge ${statusClass} status-badge">${getStatusText(lottery.current_status || lottery.status)}</span>
                        <span class="badge ${lottery.is_free ? 'bg-success' : 'bg-warning'} status-badge">${isFree}</span>
                    </div>
                    <div class="card-body">
                        <h6 class="card-title">${lottery.title}</h6>
                        <p class="card-text text-muted small">${lottery.description || 'Sin descripción'}</p>
                        
                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-1">
                                <small class="text-muted">Progreso</small>
                                <small class="text-muted">${lottery.tickets_sold || 0}/${lottery.max_tickets}</small>
                            </div>
                            <div class="progress progress-custom">
                                <div class="progress-bar" style="width: ${progress}%"></div>
                            </div>
                        </div>
                        
                        <div class="row text-center mb-3">
                            <div class="col-6">
                                <small class="text-muted">Precio</small>
                                <div class="fw-bold">${price}</div>
                            </div>
                            <div class="col-6">
                                <small class="text-muted">Ganadores</small>
                                <div class="fw-bold">${lottery.num_winners}</div>
                            </div>
                        </div>
                        
                        ${timeRemaining.days > 0 ? `
                            <div class="text-center mb-3">
                                <div class="timer">
                                    <i class="fas fa-clock"></i> ${timeRemaining.days}d ${timeRemaining.hours}h ${timeRemaining.minutes}m
                                </div>
                            </div>
                        ` : ''}
                        
                        <hr>
                        <div class="d-flex justify-content-between align-items-center">
                            <small class="text-muted">
                                <i class="fas fa-calendar"></i> ${formatDate(lottery.end_date)}
                            </small>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="viewDetails(${lottery.id})">
                                    <i class="fas fa-eye"></i> Ver
                                </button>
                                ${lottery.current_status === 'running' ? `
                                    <button class="btn btn-success" onclick="participate(${lottery.id})">
                                        <i class="fas fa-ticket-alt"></i> Participar
                                    </button>
                                ` : ''}
                                ${isLoggedIn ? `
                                    <button class="btn btn-outline-info" onclick="viewMyTickets(${lottery.id})">
                                        <i class="fas fa-list"></i> Mis Tickets
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            return col;
        }

        // Mostrar paginación
        function displayPagination(pagination) {
            const container = document.getElementById('pagination');
            container.innerHTML = '';

            if (pagination.pages <= 1) return;

            // Botón anterior
            const prevLi = document.createElement('li');
            prevLi.className = `page-item ${pagination.page <= 1 ? 'disabled' : ''}`;
            prevLi.innerHTML = `<a class="page-link" href="#" onclick="loadLotteries(${pagination.page - 1})">Anterior</a>`;
            container.appendChild(prevLi);

            // Páginas
            for (let i = 1; i <= pagination.pages; i++) {
                const li = document.createElement('li');
                li.className = `page-item ${i === pagination.page ? 'active' : ''}`;
                li.innerHTML = `<a class="page-link" href="#" onclick="loadLotteries(${i})">${i}</a>`;
                container.appendChild(li);
            }

            // Botón siguiente
            const nextLi = document.createElement('li');
            nextLi.className = `page-item ${pagination.page >= pagination.pages ? 'disabled' : ''}`;
            nextLi.innerHTML = `<a class="page-link" href="#" onclick="loadLotteries(${pagination.page + 1})">Siguiente</a>`;
            container.appendChild(nextLi);
        }

        // Participar en lotería
        function participate(lotteryId) {
            if (!isLoggedIn) {
                showLoginModal();
                return;
            }

            loadLotteryDetails(lotteryId);
        }

        // Cargar detalles de lotería para participación
        async function loadLotteryDetails(lotteryId) {
            try {
                const token = localStorage.getItem('token');
                const response = await axios.get(`${API_BASE}/${lotteryId}`, {
                    headers: { Authorization: `Bearer ${token}` }
                });

                currentLottery = response.data.data;
                selectedNumbers = [];
                
                // Debug: mostrar información de la lotería
                console.log('🎯 Información de la lotería:', {
                    id: currentLottery.id,
                    title: currentLottery.title,
                    max_tickets: currentLottery.max_tickets,
                    available_numbers: currentLottery.available_numbers,
                    tickets_sold: currentLottery.tickets_sold,
                    status: currentLottery.status,
                    current_status: currentLottery.current_status
                });

                const detailsDiv = document.getElementById('lotteryDetails');
                detailsDiv.innerHTML = `
                    <h5>${currentLottery.title}</h5>
                    <p class="text-muted">${currentLottery.description || 'Sin descripción'}</p>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Tipo:</strong> ${currentLottery.is_free ? 'Gratuita' : 'De pago'}<br>
                            <strong>Precio por ticket:</strong> ${currentLottery.is_free ? 'Gratis' : `$${currentLottery.ticket_price}`}<br>
                            <strong>Tickets disponibles:</strong> ${currentLottery.tickets_remaining}
                        </div>
                        <div class="col-md-6">
                            <strong>Ganadores:</strong> ${currentLottery.num_winners}<br>
                            <strong>Fecha de fin:</strong> ${formatDate(currentLottery.end_date)}<br>
                            <strong>Participación:</strong> ${Math.round((currentLottery.tickets_sold || 0) / currentLottery.max_tickets * 100)}%
                        </div>
                    </div>
                `;

                generateNumberGrid();
                updateSelectedNumbers();
                updateTotalAmount();

                new bootstrap.Modal(document.getElementById('participationModal')).show();
            } catch (error) {
                console.error('Error al cargar detalles:', error);
                showAlert('Error al cargar los detalles de la lotería', 'danger');
            }
        }

        // Generar grid de números
        function generateNumberGrid() {
            const grid = document.getElementById('numberGrid');
            grid.innerHTML = '';

            // Crear un set de números vendidos (los que NO están en available_numbers)
            const soldNumbers = new Set();
            if (currentLottery.available_numbers) {
                // Todos los números del 1 al max_tickets que NO están en available_numbers
                for (let i = 1; i <= currentLottery.max_tickets; i++) {
                    if (!currentLottery.available_numbers.includes(i)) {
                        soldNumbers.add(i);
                    }
                }
            }

            for (let i = 1; i <= currentLottery.max_tickets; i++) {
                const button = document.createElement('button');
                button.type = 'button';
                button.className = 'number-btn';
                button.textContent = i;
                
                if (soldNumbers.has(i)) {
                    button.classList.add('sold');
                    button.disabled = true;
                } else {
                    button.onclick = () => toggleNumber(i);
                }
                
                grid.appendChild(button);
            }
        }

        // Alternar selección de número
        function toggleNumber(number) {
            const index = selectedNumbers.indexOf(number);
            if (index > -1) {
                selectedNumbers.splice(index, 1);
            } else {
                selectedNumbers.push(number);
            }
            
            updateNumberButtons();
            updateSelectedNumbers();
            updateTotalAmount();
        }

        // Actualizar botones de números
        function updateNumberButtons() {
            const buttons = document.querySelectorAll('.number-btn:not(.sold)');
            buttons.forEach(button => {
                const number = parseInt(button.textContent);
                if (selectedNumbers.includes(number)) {
                    button.classList.add('selected');
                } else {
                    button.classList.remove('selected');
                }
            });
        }

        // Actualizar números seleccionados
        function updateSelectedNumbers() {
            const span = document.getElementById('selectedNumbers');
            if (selectedNumbers.length === 0) {
                span.textContent = 'Ninguno';
            } else {
                span.textContent = selectedNumbers.sort((a, b) => a - b).join(', ');
            }
        }

        // Actualizar monto total
        function updateTotalAmount() {
            const span = document.getElementById('totalAmount');
            const total = selectedNumbers.length * (currentLottery.is_free ? 0 : currentLottery.ticket_price);
            span.textContent = currentLottery.is_free ? 'Gratis' : `$${total.toFixed(2)}`;
        }

        // Comprar tickets
        async function buyTickets() {
            if (selectedNumbers.length === 0) {
                showAlert('Debes seleccionar al menos un número', 'warning');
                return;
            }

            try {
                const token = localStorage.getItem('token');
                const payload = {
                    ticket_numbers: selectedNumbers
                };
                
                console.log('🛒 Comprando tickets:', {
                    lotteryId: currentLottery.id,
                    selectedNumbers: selectedNumbers,
                    payload: payload
                });
                
                const response = await axios.post(`${API_BASE}/${currentLottery.id}/buy`, payload, {
                    headers: { Authorization: `Bearer ${token}` }
                });

                showAlert('Tickets comprados exitosamente', 'success');
                bootstrap.Modal.getInstance(document.getElementById('participationModal')).hide();
                
                // Recargar loterías para actualizar disponibilidad
                loadLotteries(currentPage);
            } catch (error) {
                console.error('Error al comprar tickets:', error);
                showAlert(error.response?.data?.message || 'Error al comprar tickets', 'danger');
            }
        }

        // Ver mis tickets
        async function viewMyTickets(lotteryId) {
            if (!isLoggedIn) {
                showLoginModal();
                return;
            }

            try {
                const token = localStorage.getItem('token');
                const response = await axios.get(`${API_BASE}/${lotteryId}/tickets`, {
                    headers: { Authorization: `Bearer ${token}` }
                });

                const tickets = response.data.data;
                const modalBody = document.getElementById('myTicketsBody');
                
                if (tickets.length === 0) {
                    modalBody.innerHTML = `
                        <div class="text-center py-4">
                            <i class="fas fa-ticket-alt fa-3x text-muted mb-3"></i>
                            <h5>No tienes tickets en esta lotería</h5>
                            <p class="text-muted">Participa para obtener tickets</p>
                        </div>
                    `;
                } else {
                    let ticketsHtml = '<div class="row">';
                    tickets.forEach(ticket => {
                        ticketsHtml += `
                            <div class="col-md-6 mb-3">
                                <div class="card ${ticket.is_winner ? 'border-success' : 'border-primary'}">
                                    <div class="card-body text-center">
                                        <h5 class="card-title">
                                            ${ticket.is_winner ? '<i class="fas fa-trophy text-success"></i>' : '<i class="fas fa-ticket-alt text-primary"></i>'}
                                            Ticket #${ticket.ticket_number}
                                        </h5>
                                        <p class="card-text">
                                            <strong>Estado:</strong> ${getPaymentStatusText(ticket.payment_status)}<br>
                                            <strong>Fecha:</strong> ${formatDate(ticket.purchase_date)}<br>
                                            ${ticket.is_winner ? '<strong class="text-success">¡GANADOR!</strong>' : ''}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    ticketsHtml += '</div>';
                    modalBody.innerHTML = ticketsHtml;
                }
                
                new bootstrap.Modal(document.getElementById('myTicketsModal')).show();
            } catch (error) {
                console.error('Error al cargar tickets:', error);
                showAlert('Error al cargar tus tickets', 'danger');
            }
        }

        // Ver detalles de lotería
        function viewDetails(lotteryId) {
            // Implementar vista de detalles
            showAlert('Función en desarrollo', 'info');
        }

        // Mostrar modal de login
        function showLoginModal() {
            new bootstrap.Modal(document.getElementById('loginModal')).show();
        }

        // Login
        async function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            if (!username || !password) {
                showAlert('Completa todos los campos', 'warning');
                return;
            }

            try {
                const response = await axios.post('/api/v1/auth/login', {
                    username,
                    password
                });

                localStorage.setItem('token', response.data.token);
                isLoggedIn = true;
                
                document.getElementById('username').textContent = username;
                document.getElementById('loginBtn').style.display = 'none';
                document.getElementById('logoutBtn').style.display = 'inline-block';
                
                bootstrap.Modal.getInstance(document.getElementById('loginModal')).hide();
                showAlert('Sesión iniciada exitosamente', 'success');
                
                // Recargar loterías para mostrar botones de participación
                loadLotteries(currentPage);
            } catch (error) {
                console.error('Error de login:', error);
                showAlert('Usuario o contraseña incorrectos', 'danger');
            }
        }

        // Logout
        function logout() {
            localStorage.removeItem('token');
            isLoggedIn = false;
            
            document.getElementById('username').textContent = 'Invitado';
            document.getElementById('loginBtn').style.display = 'inline-block';
            document.getElementById('logoutBtn').style.display = 'none';
            
            showAlert('Sesión cerrada', 'info');
            loadLotteries(currentPage);
        }

        // Refrescar loterías
        function refreshLotteries() {
            loadLotteries(currentPage);
        }

        // Funciones auxiliares
        function getStatusClass(status) {
            const classes = {
                'draft': 'bg-secondary',
                'active': 'bg-primary',
                'running': 'bg-success',
                'pending': 'bg-warning',
                'overdue': 'bg-danger',
                'closed': 'bg-dark',
                'finished': 'bg-success',
                'cancelled': 'bg-danger'
            };
            return classes[status] || 'bg-secondary';
        }

        function getStatusText(status) {
            const texts = {
                'draft': 'Borrador',
                'active': 'Activa',
                'running': 'En curso',
                'pending': 'Pendiente',
                'overdue': 'Vencida',
                'closed': 'Cerrada',
                'finished': 'Finalizada',
                'cancelled': 'Cancelada'
            };
            return texts[status] || status;
        }

        function getPaymentStatusText(status) {
            const texts = {
                'pending': 'Pendiente',
                'paid': 'Pagado',
                'failed': 'Fallido',
                'refunded': 'Reembolsado'
            };
            return texts[status] || status;
        }

        function getTimeRemaining(endDate) {
            const now = new Date();
            const end = new Date(endDate);
            const diff = end - now;
            
            if (diff <= 0) {
                return { days: 0, hours: 0, minutes: 0 };
            }
            
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            
            return { days, hours, minutes };
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleString('es-ES');
        }

        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }
    </script>
</body>
</html> 